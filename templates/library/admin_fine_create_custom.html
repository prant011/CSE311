{% extends "library/base.html" %}

{% block title %}Fines Management{% endblock %}

{% block content %}
<div class="container-fluid mt-5">
    <div class="row mb-4">
        <div class="col-md-8">
            <h2><i class="bi bi-receipt"></i> Fines Management</h2>
        </div>
        <div class="col-md-4 text-end">
            <div class="btn-group" role="group">
                <a href="{% url 'admin_fine_select_issue' %}" class="btn btn-primary">
                    <i class="bi bi-plus-circle"></i> From Issue
                </a>
                <a href="{% url 'admin_fine_create_custom' %}" class="btn btn-success">
                    <i class="bi bi-plus-circle"></i> Custom Fine
                </a>
                <a href="{% url 'admin_dashboard' %}" class="btn btn-secondary">
                    <i class="bi bi-arrow-left"></i> Back
                </a>
            </div>
        </div>
    </div>

    <!-- Statistics -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h5 class="card-title">Total Unpaid</h5>
                    <p class="card-text">৳{{ total_unpaid }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h5 class="card-title">Paid</h5>
                    <p class="card-text">৳{{ total_paid }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h5 class="card-title">Pending</h5>
                    <p class="card-text">{{ pending_count }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h5 class="card-title">Waived</h5>
                    <p class="card-text">{{ waived_count }}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Search and Filter -->
    <div class="row mb-4">
        <div class="col-md-6">
            <input type="text" class="form-control" id="searchInput" placeholder="Search student or fine...">
        </div>
        <div class="col-md-6">
            <select class="form-select" id="filterStatus">
                <option value="">All Status</option>
                <option value="unpaid">Unpaid</option>
                <option value="paid">Paid</option>
                <option value="waived">Waived</option>
            </select>
        </div>
    </div>

    <!-- Fines Table -->
    {% if fines %}
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead class="table-dark">
                    <tr>
                        <th>Student</th>
                        <th>Amount</th>
                        <th>Reason</th>
                        <th>Status</th>
                        <th>Created</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for fine in fines %}
                    <tr>
                        <td>{{ fine.student.user.get_full_name }}</td>
                        <td>৳{{ fine.amount }}</td>
                        <td>{{ fine.reason|truncatewords:5 }}</td>
                        <td>
                            {% if fine.status == 'paid' %}
                                <span class="badge bg-success">Paid</span>
                            {% elif fine.status == 'unpaid' %}
                                <span class="badge bg-danger">Unpaid</span>
                            {% elif fine.status == 'waived' %}
                                <span class="badge bg-warning">Waived</span>
                            {% endif %}
                        </td>
                        <td>{{ fine.created_date|date:"Y-m-d" }}</td>
                        <td>
                            {% if fine.status == 'unpaid' %}
                                <a href="#" class="btn btn-sm btn-warning">Mark Paid</a>
                                <a href="#" class="btn btn-sm btn-secondary">Waive</a>
                            {% endif %}
                            <a href="#" class="btn btn-sm btn-danger">Delete</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <div class="alert alert-info text-center">
            <i class="bi bi-info-circle"></i> No fines found.
        </div>
    {% endif %}
</div>
{% endblock %}